---
import type { GetStaticPaths } from 'astro';
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import PostCard from '../../components/PostCard.astro';
import AuthorCard from '../../components/AuthorCard.astro';

export const getStaticPaths = (async () => {
  const posts = await getCollection('posts');
  const authors = await getCollection('authors');

  return authors.map((author) => ({
    params: { author: author.data.id },
    props: {
      author,
      posts: posts
        .filter((post) => post.data.author === author.data.id)
        .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()),
    },
  }));
}) satisfies GetStaticPaths;

interface Props {
  author: Awaited<ReturnType<typeof getCollection<'authors'>>>[number];
  posts: Awaited<ReturnType<typeof getCollection<'posts'>>>;
}

const { author, posts } = Astro.props;
---

<BaseLayout title={author.data.name} description={`Posts by ${author.data.name}`}>
  <div class="mx-auto max-w-5xl px-4 py-12">
    <div class="mb-8">
      <a href="/blog" class="text-primary-600 hover:underline">
        ‚Üê Back to all posts
      </a>
    </div>

    <!-- Author Info -->
    <div class="mb-12">
      <AuthorCard {...author.data} />
    </div>

    <!-- Posts Section -->
    <div>
      <h2 class="mb-6 text-2xl font-bold ">
        Posts by {author.data.name}
      </h2>
      <p class="mb-6 text-secondary">
        {posts.length} {posts.length === 1 ? 'post' : 'posts'} published
      </p>

      {posts.length > 0 ? (
        <div class="grid gap-6 md:grid-cols-2">
          {posts.map((post) => (
            <PostCard
              title={post.data.title}
              description={post.data.description}
              pubDate={post.data.pubDate}
              slug={post.id}
              tags={post.data.tags}
              body={post.body}
            />
          ))}
        </div>
      ) : (
        <p class="text-secondary">No posts yet.</p>
      )}
    </div>
  </div>
</BaseLayout>
