---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getStates, type SanityState } from '../../lib/sanity';

const states = await getStates();

// Helper to create URL-friendly slug from state name
// Strips Sanity stega encoding (zero-width Unicode characters used for visual editing)
function toSlug(name: string): string {
  // Remove zero-width characters (stega encoding) before creating slug
  const cleaned = name.replace(/[\u200B-\u200D\u200C\uFEFF]/g, '');
  return cleaned.toLowerCase().replace(/\s+/g, '-');
}

// Helper to title case
function toTitleCase(str: string): string {
  return str
    .split(' ')
    .map((word) => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())
    .join(' ');
}
---

<BaseLayout title="All States" description="Browse communities by state">
  <div class="mx-auto max-w-6xl px-4 py-12">
    <header class="mb-8">
      <h1 class="text-3xl font-bold md:text-4xl">Browse by State</h1>
      <p class="mt-2 text-secondary">
        Explore {states.length} states with available communities
      </p>
    </header>

    <div class="grid gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4">
      {states.map((state) => (
        <a
          href={`/states/${toSlug(state.name)}`}
          class="group rounded-lg border border-white/10 bg-white/5 p-4 transition-all hover:border-primary-500/50 hover:bg-white/10"
        >
          <h2 class="text-lg font-semibold group-hover:text-primary-400 transition-colors">
            {toTitleCase(state.name)}
          </h2>
        </a>
      ))}
    </div>
  </div>
</BaseLayout>
